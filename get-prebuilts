BASEDIR=`dirname $0`
CURL="curl --retry 5 --silent --show-error"
UNPACK="unzip -q -o"

echo "Fetching prebuilts:"

set -e
mkdir -p $BASEDIR/prebuilt/common/{app,lib,xbin}

# Get GooManager (Source: http://goo.im/devs/s0updev/goomanager)
echo "* Goo Manager"
$CURL -L -o $BASEDIR/prebuilt/common/apk/GooManager.apk -O -L "http://goo.im/devs/s0updev/goomanager/GooManager_2.1.2.apk"

# Get SuperSU (Source: http://forum.xda-developers.com/showthread.php?t=1538053)
echo "* Super SU"
$CURL -L -o $BASEDIR/prebuilt/common/apk/SuperSU.zip -O -L "http://download.chainfire.eu/312/SuperSU/UPDATE-SuperSU-v1.10.zip?retrieve_file=1" --referer "http://download.chainfire.eu/312/SuperSU/UPDATE-SuperSU-v1.10.zip"
$UNPACK -j -d $BASEDIR/prebuilt/common/apk $BASEDIR/prebuilt/common/apk/SuperSU.zip system/app/Superuser.apk
$UNPACK -j -d $BASEDIR/prebuilt/common/xbin $BASEDIR/prebuilt/common/apk/SuperSU.zip system/xbin/su
rm $BASEDIR/prebuilt/common/apk/SuperSU.zip

# Get Android Terminal Emulator (we use a prebuilt so it can update from the Market)
echo "* Android Terminal Emulator"
$CURL -L -o $BASEDIR/prebuilt/common/apk/Term.apk -O -L "http://jackpal.github.com/Android-Terminal-Emulator/downloads/Term.apk"
$UNPACK -j -d $BASEDIR/prebuilt/common/lib $BASEDIR/prebuilt/common/apk/Term.apk lib/armeabi/libjackpal-androidterm4.so

set +e
